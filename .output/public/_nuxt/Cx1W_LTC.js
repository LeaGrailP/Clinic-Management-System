import{c as i,o as d,a as t,t as r,B as j,r as x,C as B,A as f,e as he,k as _e,f as P,D as Ne,F as q,i as z,h as L,v as F,b as ee,w as Te,p as Pe,E as Ce,d as Se}from"./CIW3C7Ab.js";const De={class:"relative"},Ie=["type","readonly","value"],Ae={class:"absolute left-3 -top-2 text-xs text-slate-800 bg-slate-50 px-1 transition-all peer-focus:-top-2 peer-focus:text-xs peer-placeholder-shown:top-2 peer-placeholder-shown:text-sm dark:text-slate-100 dark:bg-slate-800"},Ee={__name:"BaseInput",props:{label:{type:String,required:!0},modelValue:{type:[String,Number],default:""},readonly:{type:Boolean,default:!1},type:{type:String,default:"text"}},emits:["update:modelValue"],setup(C,{emit:Q}){return(c,_)=>(d(),i("div",De,[t("input",{type:C.type,readonly:C.readonly,value:C.modelValue,onInput:_[0]||(_[0]=S=>c.$emit("update:modelValue",S.target.value)),class:"peer block w-full rounded-lg border border-slate-400 bg-slate-50 text-slate-800 focus:outline-none focus:ring-0 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100"},null,40,Ie),t("label",Ae,r(C.label),1)]))}},Ve=globalThis.setInterval,je={key:0,class:"w-full h-2 bg-slate-300 dark:bg-slate-700 rounded-b"},qe={class:"min-h-screen p-6 space-y-6 pb-32 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-slate-100"},Le={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},$e={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Re={class:"p-4 rounded-xl shadow bg-slate-100 dark:bg-slate-600 border-slate-200 dark:border-slate-700 flex flex-col gap-4"},Be={class:"grid grid-cols-2 sm:grid-cols-3 xl:grid-cols-4 gap-3 overflow-auto max-h-[420px]"},ze=["onClick"],Fe={class:"p-4 rounded-xl shadow border overflow-auto bg-slate-100 dark:bg-slate-600 border-slate-200 dark:border-slate-700"},Ue={class:"min-w-full text-sm border rounded-lg overflow-hidden text-slate-800 dark:text-slate-100 border-gray-400 dark:border-slate-700"},Me={class:"px-4 py-2 border-b text-slate-800 dark:text-slate-100 dark:border-slate-700"},Oe={class:"px-4 py-2 border-b text-center text-slate-800 dark:text-slate-100 dark:border-slate-700"},He={class:"px-4 py-2 border-b text-right text-slate-800 dark:text-slate-100 dark:border-slate-700"},We={class:"px-4 py-2 border-b dark:border-slate-700"},Qe={class:"flex justify-center gap-2"},Ze=["onClick"],Ge=["onClick"],Je=["onClick"],Ke={class:"flex flex-col gap-4"},Xe={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-4"},Ye={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-3"},et={class:"flex justify-between items-center"},tt={key:0,class:"space-y-2 border-gray-400"},st={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-2"},at={class:"flex justify-between text-sm"},lt={class:"flex justify-between text-sm"},rt={class:"flex justify-between text-sm"},nt={class:"flex justify-between text-sm"},ot={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-3"},it={class:"flex justify-between items-center"},dt={class:"flex justify-between text-lg"},ut={class:"font-semibold"},ct={class:"p-4 rounded-xl shadow border flex justify-between items-center bg-sky-400 dark:bg-sky-800 border-slate-300 dark:border-slate-700"},bt={class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},pt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},vt={class:"p-4 rounded-lg shadow-lg w-[320px] max-h-[90vh] overflow-auto bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100"},mt={class:"flex mb-1 justify-between"},yt={class:"flex mb-1 justify-between"},ft={class:"flex mb-1 justify-between"},xt={key:0,class:"flex mb-1 justify-between"},gt={key:1,class:"flex mb-1 justify-between"},kt={key:2,class:"flex justify-between mb-1"},wt={class:"flex justify-between mb-1"},ht={class:"flex justify-between mb-1"},_t={class:"flex justify-between mb-1"},Nt={class:"flex justify-between mb-1"},Tt={class:"flex justify-between mb-1 font-bold"},Pt={class:"flex justify-between mb-1"},Ct={class:"flex justify-between mb-2 font-semibold"},St={class:"flex justify-between mt-4"},Dt=["disabled"],At={__name:"dashboard",setup(C,{expose:Q}){const c=j({invoiceNumber:"",issuedBy:localStorage.getItem("name")||"Unknown User",invoiceDate:"",invoiceTime:""}),_=x(!1),S=x(""),U=x("");let D=null;const Z=x([]),n=x([]),l=j({subtotal:0,vat_sales:0,vat_amount:0,vat_exempt_sales:0,zero_rated_sales:0,discount:0,total:0}),m=j({type:"",amount:0,rate:0,raw:""}),y=j({name:"",tin:""}),g=j({active:!1,value:0}),k=x(0),$=x(null),M=x(!1);function b(s){return Math.round(Number(s||0)*100)/100}function u(s){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(Number(s)||0)}function G(){const s=new Date;c.invoiceDate=s.toISOString().split("T")[0],c.invoiceTime=s.toTimeString().slice(0,5)}B(S,s=>{D&&clearTimeout(D),D=setTimeout(()=>U.value=String(s||"").trim().toLowerCase(),250)});function N(s=600){return new Promise(e=>{g.active=!0,g.value=0;const p=performance.now();function a(v){const o=v-p,E=Math.min(80,o/s*80);g.value=E,E<80?requestAnimationFrame(a):e()}requestAnimationFrame(a)})}const J={name:localStorage.getItem("name"),role:localStorage.getItem("role")};async function te(){if(console.log("ROLE:",J.role),J.role!=="admin")return alert("âŒ Only admins can open the cash drawer.");try{await window.electron.invoke("open-cash-drawer"),alert("âœ… Cash drawer opened!")}catch(s){alert("Failed to open drawer: "+(s?.message||s))}}const se=x(""),O=x([]);let I=null;B(se,s=>{I&&clearTimeout(I),I=setTimeout(()=>{ae(s)},250)});async function ae(s){if(!s){O.value=[];return}try{const e=await window.electron.invoke("search-patients",s);O.value=Array.isArray(e)?e:[]}catch(e){console.error("fetchPatientMatches:",e),O.value=[]}}const K=f(()=>Z.value.slice().sort((s,e)=>String(s.productname||"").localeCompare(String(e.productname||""),void 0,{sensitivity:"base"}))),le=f(()=>{if(!U.value)return K.value;const s=U.value;return K.value.filter(e=>(e.productname||"").toLowerCase().includes(s)||(e.sku||"").toLowerCase().includes(s))});async function re(){try{const s=await window.electron.invoke("get-products");Z.value=Array.isArray(s)?s:[]}catch(s){console.error("fetchProducts:",s)}}async function H(){try{c.invoiceNumber=await window.electron.invoke("generate-invoice-number")}catch(s){console.error("generateInvoiceNumber:",s)}}function ne(s){if(!s||!s.id)return;const e=n.value.find(a=>a.id===s.id),p=Number(s.price??s.unitPrice??s.total??0);e?(e.quantity=Number(e.quantity||0)+1,e.total=b(e.quantity*(e.unitPrice||e.price||p))):n.value.push({id:s.id,productname:s.productname||s.name||"Unnamed",quantity:1,unitPrice:p,price:p,total:b(p)}),w()}function oe(s){const e=n.value[s];e&&(e.quantity=Number(e.quantity||0)+1,e.total=b(e.quantity*(e.unitPrice||e.price||0)),w())}function ie(s){const e=n.value[s];e&&(e.quantity>1?(e.quantity=Number(e.quantity)-1,e.total=b(e.quantity*(e.unitPrice||e.price||0))):n.value.splice(s,1),w())}function de(s){s>=0&&s<n.value.length&&(n.value.splice(s,1),w())}function w(){let s=0,e=0,p=0,a=0,v=0;for(const h of n.value){const V=Number(h.quantity||0),we=Number(h.unitPrice??h.price??0),Y=b(we*V);h.total=Y,s+=Y,e+=Number(h.vatSales||0)*V,p+=Number(h.vatAmount||0)*V,a+=Number(h.vatExempt||0)*V,v+=Number(h.zeroRated||0)*V}l.subtotal=b(s);let o=0;m.type==="SC"||m.type==="PWD"?o=b(e*.2):o=b(s*(Number(l.discount||0)/100)),o<0&&(o=0),o>s&&(o=s);const E=b(Math.max(0,s-o)),R=s>0?E/s:1;l.vat_sales=b(e*R),l.vat_amount=b(p*R),l.vat_exempt_sales=b(a*R),l.zero_rated_sales=b(v*R),l.total=E,l._discountAmount=o}B(n,()=>w(),{deep:!0}),B(()=>[m.type,m.manual,l.discount],()=>w());const ue=f(()=>n.value.reduce((s,e)=>s+Number(e.total||0),0)),ce=f(()=>{const s=ue.value;return m.type==="SC"||m.type==="PWD"?+(l.vat_sales*.2):+(s*(Number(l.discount||0)/100))}),X=f(()=>Math.max(0,Number(k.value)-Number(l.total||0)));f(()=>n.value.map(s=>be(s.quantity,s.productname,s.total)));function be(s,e,p){const a=String(s).padEnd(4," "),v=e.length>18?e.slice(0,18):e.padEnd(18," "),o=Number(p||0).toFixed(2).padStart(10," ");return`${a}${v}${o}`}const pe=f(()=>n.value.length===0),ve=f(()=>!k.value||isNaN(k.value)||Number(k.value)<=0),me=f(()=>Number(k.value)<Number(l.total)),A=f(()=>!pe.value&&!ve.value&&!me.value),ye=f(()=>!A.value);function W(){n.value=[],l.discount=0,m.type="",k.value=0,y.name="",y.tin="",w()}async function fe(){if(!n.value.length)return alert("No products added!");if(!A.value)return alert("Tendered amount required");const s={date:c.invoiceDate,total:l.total,discount_amount:ce.value,discount_type:m.type||"NONE",vat_sales:l.vat_sales,vat_amount:l.vat_amount,vat_exempt_sales:l.vat_exempt_sales,zero_rated_sales:l.zero_rated_sales,customer_name:y.name||c.issuedBy,items:JSON.stringify(n.value)};try{const e=await window.electron.invoke("add-invoice",s);alert(`Invoice saved! Number: ${e.invoice_number}`),W(),H()}catch(e){console.error("saveInvoice:",e)}}async function xe(){try{const s=await window.electron.invoke("check-printer-status");alert(s.connected?"âœ… Printer detected!":"âŒ Printer not detected.")}catch(s){console.error("checkPrinter:",s)}}async function ge(){if(!A.value)return alert("Cannot print: missing or invalid inputs.");if(!$.value)return alert("Receipt template not found!");try{const s=$.value.outerHTML;if(M.value)return;M.value=!0,(await window.electron.invoke("print-receipt",{html:s,openDrawer:!0})).success?(alert("ðŸ–¨ Receipt printed successfully!"),W(),H()):alert("âŒ Print failed!")}catch(s){console.error("printReceipt:",s),alert("Printing error: "+(s&&s.message?s.message:s))}finally{M.value=!1}}he(()=>{G();const s=Ve(G,1e3);re(),H(),w();const e={save:async()=>{await N(800),await fe(),await T()},cancel:async()=>{await N(400),W(),await T()},drawer:async()=>{await N(500),await te(),await T()},checkPrinter:async()=>{await N(600),await xe(),await T()},preview:async()=>{if(!A.value)return alert("Please enter tendered amount equal to or greater than total before previewing.");await N(300),_.value=!0,await T()}};window.addEventListener("footer-save",e.save),window.addEventListener("footer-cancel",e.cancel),window.addEventListener("footer-open-drawer",e.drawer),window.addEventListener("footer-check-printer",e.checkPrinter),window.addEventListener("footer-preview-receipt",e.preview),_e(()=>{clearInterval(s),D&&clearTimeout(D),I&&clearTimeout(I),window.removeEventListener("footer-save",e.save),window.removeEventListener("footer-cancel",e.cancel),window.removeEventListener("footer-open-drawer",e.drawer),window.removeEventListener("footer-check-printer",e.checkPrinter),window.removeEventListener("footer-preview-receipt",e.preview)})});async function T(){g.value=100,setTimeout(()=>{g.active=!1,g.value=0},150)}Q({progress:g,startProgress:N,finishProgress:T});const ke=[{label:"Invoice Number",key:"invoiceNumber"},{label:"Issued By",key:"issuedBy"},{label:"Date",key:"invoiceDate"},{label:"Time",key:"invoiceTime"}];return(s,e)=>{const p=Ce("router-link");return d(),i(q,null,[g.active?(d(),i("div",je,[t("div",{class:"h-full bg-sky-500 dark:bg-sky-400 transition-all",style:Ne({width:g.value+"%"})},null,4)])):P("",!0),t("div",qe,[t("div",Le,[(d(),i(q,null,z(ke,a=>ee(Ee,{key:a.key,label:a.label,modelValue:c[a.key],"onUpdate:modelValue":v=>c[a.key]=v,readonly:"",class:"dark:bg-slate-800 border-gray-400 dark:text-slate-100"},null,8,["label","modelValue","onUpdate:modelValue"])),64))]),t("div",$e,[t("div",Re,[L(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>S.value=a),placeholder:"Search products...",class:"w-full px-3 py-2 rounded-lg border border-gray-400 bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-sky-400"},null,512),[[F,S.value]]),t("div",Be,[(d(!0),i(q,null,z(le.value,a=>(d(),i("button",{key:a.id,onClick:v=>ne(a),class:"p-3 rounded-lg shadow transition bg-slate-100 dark:bg-slate-800 hover:bg-sky-200 dark:hover:bg-sky-600 text-center text-sm text-slate-800 dark:text-slate-100 break-words"},r(a.productname),9,ze))),128))])]),t("div",Fe,[t("table",Ue,[e[8]||(e[8]=t("thead",{class:"bg-slate-100 dark:bg-slate-800"},[t("tr",null,[t("th",{class:"px-4 py-2 border-b text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Product"),t("th",{class:"px-4 py-2 border-b text-center text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Qty"),t("th",{class:"px-4 py-2 border-b text-right text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Price"),t("th",{class:"px-4 py-2 border-b text-center text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Action")])],-1)),t("tbody",null,[(d(!0),i(q,null,z(n.value,(a,v)=>(d(),i("tr",{key:a.id,class:"hover:bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-slate-100 transition"},[t("td",Me,r(a.productname),1),t("td",Oe,r(a.quantity),1),t("td",He,"â‚±"+r(Number(a.total).toFixed(2)),1),t("td",We,[t("div",Qe,[t("button",{onClick:o=>ie(v),class:"px-3 py-1 rounded-md font-bold bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-500"},"âˆ’",8,Ze),t("button",{onClick:o=>oe(v),class:"px-3 py-1 rounded-md font-bold bg-sky-300 dark:bg-sky-700 hover:bg-sky-400 dark:hover:bg-sky-600"},"+",8,Ge),t("button",{onClick:o=>de(v),class:"px-3 py-1 rounded-md font-bold bg-red-400 dark:bg-red-700 hover:bg-red-500 dark:hover:bg-red-600"},"Ã—",8,Je)])])]))),128))])])]),t("div",Ke,[t("div",Xe,[e[10]||(e[10]=t("h2",{class:"font-semibold text-lg text-slate-800 dark:text-slate-100"},"Customer",-1)),L(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>y.name=a),placeholder:"Customer Name (Optional)",class:"w-full text-sm px-3 py-2 rounded border bg-white dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,512),[[F,y.name]]),L(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>y.tin=a),placeholder:"TIN (Optional)",class:"w-full text-sm px-3 py-2 rounded border bg-white dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,512),[[F,y.tin]]),ee(p,{to:"/customer",class:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors duration-200"},{default:Te(()=>[...e[9]||(e[9]=[Se(" Register Customer ",-1)])]),_:1})]),t("div",Ye,[t("div",et,[e[12]||(e[12]=t("h2",{class:"font-semibold text-lg text-slate-800 dark:text-slate-100"},"Discount Type",-1)),L(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>m.type=a),class:"px-2 py-1 rounded border text-sm bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},[...e[11]||(e[11]=[t("option",{value:""},"None",-1),t("option",{value:"SC"},"Senior Citizen (20%)",-1),t("option",{value:"PWD"},"PWD (20%)",-1)])],512),[[Pe,m.type]])]),m.type==="SC"||m.type==="PWD"?(d(),i("div",tt)):P("",!0)]),t("div",st,[e[17]||(e[17]=t("h2",{class:"font-semibold text-lg text-slate-800 dark:text-slate-100"},"VAT Summary",-1)),t("div",at,[e[13]||(e[13]=t("p",{class:"text-slate-700 dark:text-slate-200"},"VATable Sales",-1)),t("p",null,r(u(l.vat_sales)),1)]),t("div",lt,[e[14]||(e[14]=t("p",{class:"text-slate-700 dark:text-slate-200"},"VAT Amount (12%)",-1)),t("p",null,r(u(l.vat_amount)),1)]),t("div",rt,[e[15]||(e[15]=t("p",{class:"text-slate-700 dark:text-slate-200"},"VAT Exempt",-1)),t("p",null,r(u(l.vat_exempt_sales)),1)]),t("div",nt,[e[16]||(e[16]=t("p",{class:"text-slate-700 dark:text-slate-200"},"Zero-Rated",-1)),t("p",null,r(u(l.zero_rated_sales)),1)])]),t("div",ot,[t("div",it,[e[18]||(e[18]=t("span",{class:"text-lg text-slate-800 dark:text-slate-100"},"TENDERED",-1)),L(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>k.value=a),onInput:e[5]||(e[5]=a=>w()),class:"w-32 text-right border rounded px-2 py-1 bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,544),[[F,k.value]])]),t("div",dt,[e[19]||(e[19]=t("span",{class:"text-slate-800 dark:text-slate-100"},"CHANGE",-1)),t("span",ut,r(u(X.value)),1)])]),t("div",ct,[e[20]||(e[20]=t("span",{class:"text-xl font-semibold text-slate-900 dark:text-slate-100"},"TOTAL",-1)),t("span",bt,r(u(l.total||0)),1)])])]),_.value?(d(),i("div",pt,[t("div",vt,[e[41]||(e[41]=t("h2",{class:"text-lg font-bold mb-3 text-center"},"Receipt Preview",-1)),t("div",{ref_key:"receipt",ref:$},[t("div",{ref_key:"receipt",ref:$,class:"receipt-container"},[e[34]||(e[34]=t("div",{class:"text-center mb-1"},[t("h3",null,"FELTHEA STORE"),t("p",null,"123 Sample St., Barangay, City"),t("p",null,"TIN: 123-456-789"),t("p",null,"Tel: 0912-345-6789")],-1)),e[35]||(e[35]=t("hr",null,null,-1)),t("div",mt,[e[21]||(e[21]=t("span",null,"Invoice #: ",-1)),t("span",null,r(c.invoiceNumber),1)]),t("div",yt,[e[22]||(e[22]=t("span",null,"Date: ",-1)),t("span",null,r(c.invoiceDate)+" "+r(c.invoiceTime),1)]),t("div",ft,[e[23]||(e[23]=t("span",null,"Cashier: ",-1)),t("span",null,r(c.issuedBy),1)]),y.name?(d(),i("div",xt,[e[24]||(e[24]=t("span",null,"Customer: ",-1)),t("span",null,r(y.name),1)])):P("",!0),y.tin?(d(),i("div",gt,[e[25]||(e[25]=t("span",null,"TIN: ",-1)),t("span",null,r(y.tin),1)])):P("",!0),e[36]||(e[36]=t("hr",null,null,-1)),(d(!0),i(q,null,z(n.value,a=>(d(),i("div",{key:a.id,class:"flex justify-between mb-1"},[t("span",null,r(a.quantity)+" x "+r(a.productname),1),t("span",null,r(Number(a.total).toFixed(2)),1)]))),128)),e[37]||(e[37]=t("hr",null,null,-1)),l._discountAmount>0?(d(),i("div",kt,[e[26]||(e[26]=t("span",null,"Discount",-1)),t("span",null,"-"+r(u(l._discountAmount)),1)])):P("",!0),t("div",wt,[e[27]||(e[27]=t("span",null,"VATable Sales",-1)),t("span",null,r(u(l.vat_sales)),1)]),t("div",ht,[e[28]||(e[28]=t("span",null,"VAT (12%)",-1)),t("span",null,r(u(l.vat_amount)),1)]),t("div",_t,[e[29]||(e[29]=t("span",null,"VAT-Exempt",-1)),t("span",null,r(u(l.vat_exempt_sales)),1)]),t("div",Nt,[e[30]||(e[30]=t("span",null,"Zero-Rated",-1)),t("span",null,r(u(l.zero_rated_sales)),1)]),e[38]||(e[38]=t("hr",null,null,-1)),t("div",Tt,[e[31]||(e[31]=t("span",null,"Total",-1)),t("span",null,r(u(l.total)),1)]),t("div",Pt,[e[32]||(e[32]=t("span",null,"Tendered",-1)),t("span",null,r(u(k.value)),1)]),t("div",Ct,[e[33]||(e[33]=t("span",null,"Change",-1)),t("span",null,r(u(X.value)),1)]),e[39]||(e[39]=t("hr",null,null,-1)),e[40]||(e[40]=t("div",{class:"text-center mt-2"},[t("p",null,"*** This serves as an official receipt ***"),t("p",null,"Thank you for your purchase!")],-1))],512)],512),t("div",St,[t("button",{onClick:e[6]||(e[6]=a=>_.value=!1),class:"w-1/2 mr-2 py-2 px-4 rounded shadow bg-red-500 hover:bg-red-600 text-slate-100"},"Cancel"),t("button",{disabled:ye.value,onClick:e[7]||(e[7]=a=>{A.value&&(ge(),_.value=!1)}),class:"w-1/2 ml-2 py-2 px-4 rounded shadow bg-green-500 hover:bg-green-600 text-slate-100 disabled:opacity-40"},"Confirm",8,Dt)])])])):P("",!0)])],64)}}};export{At as default};
