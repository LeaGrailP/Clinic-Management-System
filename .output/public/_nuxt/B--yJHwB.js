import{_ as G,r as o,e as D,k as J,c as w,o as d,b as K,a as t,f as A,F as C,g as V,h as u,v as g,l as L,m as z,n as E,p as I,q as Q,t as $,s as X,x as Z}from"./HKRDA1XH.js";import{u as _}from"./B_EyR7Fy.js";import{c as j}from"./DFVXK_RO.js";const ee={__name:"background",setup(O){const b=o(null);let s,r=[];const f=()=>{const c=b.value.getContext("2d"),p=window.innerWidth,v=window.innerHeight;b.value.width=p,b.value.height=v,r=Array.from({length:100},()=>({x:Math.random()*p,y:Math.random()*v,size:Math.random()*2+1,alpha:Math.random(),delta:Math.random()*.02+.005}));const m=()=>{c.clearRect(0,0,p,v);for(let n of r)n.alpha+=n.delta,(n.alpha>=1||n.alpha<=0)&&(n.delta*=-1),c.fillStyle=`rgba(255,255,255,${n.alpha})`,c.fillRect(n.x,n.y,n.size,n.size);s=requestAnimationFrame(m)};m()};return D(()=>{f(),window.addEventListener("resize",f)}),J(()=>{cancelAnimationFrame(s),window.removeEventListener("resize",f)}),(c,p)=>(d(),w("canvas",{ref_key:"canvas",ref:b,class:"fixed top-0 left-0 w-full h-full z-[-1]"},null,512))}},te=G(ee,[["__scopeId","data-v-0cbee482"]]);const R=j("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const B=j("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ae={class:"min-h-screen flex items-center justify-center relative"},le={class:"z-10 p-8 bg-white/10 backdrop-blur-lg rounded-xl shadow-2xl w-[380px]"},ne={key:0,class:"text-white text-center text-lg py-4"},oe={class:"relative"},se=["type"],re={class:"relative"},ue=["type"],ie=["disabled"],de={class:"flex items-center gap-2 text-white mt-2"},ce=["disabled"],pe={key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-md flex items-center justify-center z-[999]"},ve={class:"bg-white/10 backdrop-blur-lg p-6 rounded-xl shadow-2xl w-[320px] text-white"},me={class:"flex gap-3"},be={__name:"index",setup(O){const b=Z(),s=o(""),r=o(""),f=o("admin"),c=o(!1),p=o(!1),v=o(""),m=o(""),n=o(""),x=o(""),k=o(!1),P=o(!1),y=o(!1),h=o(""),i=o("checking"),U=_("user",()=>null);D(async()=>{try{const l=await window.electronAPI.checkAdmin();i.value=l?"login":"setup"}catch(l){console.error(l),i.value="setup"}});function T(){s.value="",r.value="",v.value=""}function S(l){return/^[0-9]{6}$/.test(l)}async function q(){if(!s.value||!r.value)return alert("Please enter admin name and password.");if(!S(v.value))return alert("PIN must be exactly 6 digits.");try{const l=await window.electronAPI.createAdmin({name:s.value,password:r.value,pin:v.value});l?.success?(alert(`Admin account created!
⚠ IMPORTANT: Remember your master PIN!`),T(),i.value="login"):alert(l?.error||"Failed to create admin.")}catch(l){console.error(l),alert("An error occurred.")}}async function Y(){if(!s.value||!r.value)return alert("Please enter your name and password.");P.value=!0;try{const l=await window.electronAPI.login({role:f.value,name:s.value,password:r.value});l?.success?(localStorage.setItem("token","true"),localStorage.setItem("name",l.name),localStorage.setItem("role",l.role),U.value={name:l.name,role:l.role},b.push("/dashboard")):alert(l?.error||"Login failed.")}catch(l){console.error(l),alert("An error occurred.")}finally{P.value=!1}}const M=o(!1),N=o("");function F(){N.value=m.value,M.value=!0}async function H(){m.value=N.value,M.value=!1,await W()}async function W(){if(!n.value||!m.value)return alert("Please enter the username and master PIN.");if(!S(m.value))return alert("Master PIN must be exactly 6 digits.");if(n.value===U.value?.name)return alert("You cannot modify your own credentials. Ask another admin.");if(!x.value)return alert("Please enter the new password.");if(y.value&&!h.value)return alert("Please enter a new username.");k.value=!0;try{const l=await window.electronAPI.resetPassword({name:n.value,newPassword:x.value,newName:y.value?h.value:null,pin:m.value});if(!l?.success)return alert(l.error||"Update failed.");alert("Changes applied successfully!"),n.value="",x.value="",h.value="",m.value="",y.value=!1,i.value="login"}catch(l){console.error(l),alert("An error occurred.")}finally{k.value=!1}}return(l,e)=>(d(),w("div",ae,[K(te),t("div",le,[i.value==="checking"?(d(),w("div",ne,"Loading...")):i.value==="setup"?(d(),w(C,{key:1},[e[17]||(e[17]=t("h2",{class:"text-2xl font-semibold text-center text-white mb-6"}," Setup Admin Account ",-1)),e[18]||(e[18]=t("p",{class:"text-yellow-300 text-sm mb-4 text-center"}," ⚠ Please remember your Master PIN. You cannot recover it. ",-1)),t("form",{onSubmit:V(q,["prevent"]),class:"space-y-4"},[u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),type:"text",placeholder:"Admin Name",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[g,s.value]]),t("div",oe,[u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),type:c.value?"text":"password",placeholder:"Admin Password",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,8,se),[[L,r.value]]),t("button",{type:"button",onClick:e[2]||(e[2]=a=>c.value=!c.value),class:"absolute right-3 top-1/2 -translate-y-1/2"},[(d(),z(E(c.value?I(R):I(B)),{class:"w-5 h-5 text-black"}))])]),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a),type:"password",maxlength:"6",placeholder:"Master PIN (6 digits)",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[g,v.value]]),e[16]||(e[16]=t("button",{class:"w-full bg-green-500 text-white py-2 rounded hover:bg-green-600"}," Create Admin ",-1))],32)],64)):i.value==="login"?(d(),w(C,{key:2},[e[20]||(e[20]=t("h2",{class:"text-2xl font-semibold text-center text-white mb-6"}," Login ",-1)),t("form",{onSubmit:V(Y,["prevent"]),class:"space-y-4"},[u(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),class:"w-full p-3 rounded bg-white/80 text-gray-900"},[...e[19]||(e[19]=[t("option",{value:"admin"},"Admin",-1),t("option",{value:"cashier"},"Cashier",-1)])],512),[[Q,f.value]]),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.value=a),type:"text",placeholder:"Name",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[g,s.value]]),t("div",re,[u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>r.value=a),type:p.value?"text":"password",placeholder:"Password",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,8,ue),[[L,r.value]]),t("button",{type:"button",onClick:e[7]||(e[7]=a=>p.value=!p.value),class:"absolute right-3 top-1/2 -translate-y-1/2"},[(d(),z(E(p.value?I(R):I(B)),{class:"w-5 h-5 text-black"}))])]),t("button",{disabled:P.value,class:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:bg-gray-400"},$(P.value?"Processing...":"Login"),9,ie),t("p",{class:"text-center text-white underline cursor-pointer",onClick:e[8]||(e[8]=a=>i.value="forgot")}," Forgot Password? ")],32)],64)):i.value==="forgot"?(d(),w(C,{key:3},[e[22]||(e[22]=t("h2",{class:"text-2xl font-semibold text-center text-white mb-6"}," Reset Password ",-1)),t("form",{onSubmit:V(F,["prevent"]),class:"space-y-4"},[u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>n.value=a),type:"text",placeholder:"Existing Username",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[g,n.value]]),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=a=>x.value=a),type:"password",placeholder:"New Password",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[g,x.value]]),t("div",de,[u(t("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=a=>y.value=a)},null,512),[[X,y.value]]),e[21]||(e[21]=t("label",null,"Change username?",-1))]),y.value?u((d(),w("input",{key:0,"onUpdate:modelValue":e[12]||(e[12]=a=>h.value=a),type:"text",placeholder:"New Username",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512)),[[g,h.value]]):A("",!0),t("button",{type:"button",class:"w-full p-3 rounded bg-white/20 text-white hover:bg-white/30",onClick:F}," Enter Master PIN "),t("button",{disabled:k.value,class:"w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700 disabled:bg-gray-400"},$(k.value?"Updating...":"Save"),9,ce),t("p",{class:"text-center text-white underline cursor-pointer",onClick:e[13]||(e[13]=a=>i.value="login")}," Back to Login ")],32)],64)):A("",!0)]),M.value?(d(),w("div",pe,[t("div",ve,[e[23]||(e[23]=t("h3",{class:"text-xl font-semibold mb-4 text-center"}," Enter Master PIN ",-1)),u(t("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>N.value=a),type:"password",maxlength:"6",placeholder:"6-digit PIN",class:"w-full p-3 mb-4 rounded bg-white/20 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400"},null,512),[[g,N.value]]),t("div",me,[t("button",{class:"flex-1 bg-gray-500/50 hover:bg-gray-600/70 py-2 rounded text-white font-medium transition",onClick:e[15]||(e[15]=a=>M.value=!1)}," Cancel "),t("button",{class:"flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded text-white font-medium transition",onClick:H}," Confirm ")])])])):A("",!0)]))}};export{be as default};
