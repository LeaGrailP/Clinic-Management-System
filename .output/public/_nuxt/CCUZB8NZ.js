import{c,o as p,a,t as m,y as L,r as y,z as $,s as v,e as Ne,k as Pe,f as q,A as Ce,F as j,i as H,h,v as C,b as re,w as Se,l as De,B as Te,d as Ie}from"#entry";const Ae={class:"relative"},Ve=["type","readonly","value"],Ee={class:"absolute left-3 -top-2 text-xs text-slate-800 bg-slate-50 px-1 transition-all peer-focus:-top-2 peer-focus:text-xs peer-placeholder-shown:top-2 peer-placeholder-shown:text-sm dark:text-slate-100 dark:bg-slate-800"},Le={__name:"BaseInput",props:{label:{type:String,required:!0},modelValue:{type:[String,Number],default:""},readonly:{type:Boolean,default:!1},type:{type:String,default:"text"}},emits:["update:modelValue"],setup(D,{emit:Q}){return(x,g)=>(p(),c("div",Ae,[a("input",{type:D.type,readonly:D.readonly,value:D.modelValue,onInput:g[0]||(g[0]=T=>x.$emit("update:modelValue",T.target.value)),class:"peer block w-full rounded-lg border border-slate-400 bg-slate-50 text-slate-800 focus:outline-none focus:ring-0 dark:bg-slate-800 dark:border-slate-600 dark:text-slate-100"},null,40,Ve),a("label",Ee,m(D.label),1)]))}},qe=globalThis.setInterval,Me={key:0,class:"w-full h-2 bg-slate-300 dark:bg-slate-700 rounded-b"},Ue={class:"min-h-screen p-6 space-y-6 pb-32 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-slate-100"},$e={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},je={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Re={class:"p-4 rounded-xl shadow bg-slate-100 dark:bg-slate-600 border-slate-200 dark:border-slate-700 flex flex-col gap-4"},ze={class:"grid grid-cols-2 sm:grid-cols-3 xl:grid-cols-4 gap-3 overflow-auto max-h-[420px]"},Be=["onClick"],Fe={class:"p-4 rounded-xl shadow border overflow-auto bg-slate-100 dark:bg-slate-600 border-slate-200 dark:border-slate-700"},Oe={class:"min-w-full text-sm border rounded-lg overflow-hidden text-slate-800 dark:text-slate-100 border-gray-400 dark:border-slate-700"},We={class:"px-4 py-2 border-b text-slate-800 dark:text-slate-100 dark:border-slate-700"},He={class:"px-4 py-2 border-b text-center text-slate-800 dark:text-slate-100 dark:border-slate-700"},Qe={class:"px-4 py-2 border-b text-right text-slate-800 dark:text-slate-100 dark:border-slate-700"},Ge={class:"px-4 py-2 border-b dark:border-slate-700"},Je={class:"flex justify-center gap-2"},Ze=["onClick"],Ke=["onClick"],Xe=["onClick"],Ye={class:"flex flex-col gap-4"},et={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-4"},tt={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-3"},at={class:"flex justify-between items-center"},rt={key:0,class:"space-y-2 border-gray-400"},st={key:1,class:"flex justify-between items-center"},ot={key:2,class:"flex justify-between items-center"},nt=["value"],lt={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-2"},it={class:"flex justify-between text-sm"},dt={class:"flex justify-between text-sm"},ut={class:"flex justify-between text-sm"},ct={class:"flex justify-between text-sm"},pt={class:"p-4 rounded-xl shadow border bg-slate-100 dark:bg-slate-700 border-slate-200 dark:border-slate-600 space-y-3"},bt={class:"flex justify-between items-center"},vt={class:"flex justify-between text-lg"},mt={class:"font-semibold"},yt={class:"p-4 rounded-xl shadow border flex justify-between items-center bg-sky-400 dark:bg-sky-800 border-slate-300 dark:border-slate-700"},xt={class:"text-2xl font-bold text-slate-900 dark:text-slate-100"},gt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ft={class:"p-4 rounded-lg shadow-lg w-[320px] max-h-[90vh] overflow-auto bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-slate-100"},kt={class:"flex justify-between mt-4"},wt=["disabled"],_t={__name:"dashboard",setup(D,{expose:Q}){const x=L({invoiceNumber:"",issuedBy:localStorage.getItem("name")||"Unknown User",invoiceDate:"",invoiceTime:""}),g=y(!1),T=y(""),R=y("");let I=null;const G=y([]),l=y([]),s=L({subtotal:0,vat_sales:0,vat_amount:0,vat_exempt_sales:0,zero_rated_sales:0,discount:0,total:0}),o=L({type:"",name:"",id_no:"",manual:"",amount:0,rate:0,raw:""}),_=L({name:"",tin:""}),f=L({active:!1,value:0}),w=y(0),z=y(null),B=y(!1);function u(t){return Math.round(Number(t||0)*100)/100}function S(t){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(Number(t)||0)}function J(){const t=new Date;x.invoiceDate=t.toISOString().split("T")[0],x.invoiceTime=t.toTimeString().slice(0,5)}$(T,t=>{I&&clearTimeout(I),I=setTimeout(()=>R.value=String(t||"").trim().toLowerCase(),250)});function N(t=600){return new Promise(e=>{f.active=!0,f.value=0;const n=performance.now();function r(i){const d=i-n,V=Math.min(80,d/t*80);f.value=V,V<80?requestAnimationFrame(r):e()}requestAnimationFrame(r)})}const Z={name:localStorage.getItem("name"),role:localStorage.getItem("role")};async function K(){if(console.log("ROLE:",Z.role),Z.role!=="admin")return alert("âŒ Only admins can open the cash drawer.");try{await window.electron.invoke("open-cash-drawer"),alert("âœ… Cash drawer opened!")}catch(t){alert("Failed to open drawer: "+(t?.message||t))}}const se=y(""),F=y([]);let O=null;$(se,t=>{O&&clearTimeout(O),O=setTimeout(()=>{oe(t)},250)});async function oe(t){if(!t){F.value=[];return}try{const e=await window.electron.invoke("search-patients",t);F.value=Array.isArray(e)?e:[]}catch(e){console.error("fetchPatientMatches:",e),F.value=[]}}const X=v(()=>G.value.slice().sort((t,e)=>String(t.productname||"").localeCompare(String(e.productname||""),void 0,{sensitivity:"base"}))),ne=v(()=>{if(!R.value)return X.value;const t=R.value;return X.value.filter(e=>(e.productname||"").toLowerCase().includes(t)||(e.sku||"").toLowerCase().includes(t))});async function le(){try{const t=await window.electron.invoke("get-products");G.value=Array.isArray(t)?t:[]}catch(t){console.error("fetchProducts:",t)}}async function W(){try{x.invoiceNumber=await window.electron.invoke("generate-invoice-number")}catch(t){console.error("generateInvoiceNumber:",t)}}function ie(t){if(!t||!t.id)return;const e=l.value.find(r=>r.id===t.id),n=Number(t.price??t.unitPrice??t.total??0);e?(e.quantity=Number(e.quantity||0)+1,e.total=u(e.quantity*(e.unitPrice||e.price||n))):l.value.push({id:t.id,productname:t.productname||t.name||"Unnamed",quantity:1,unitPrice:n,price:n,total:u(n)}),b()}function de(t){const e=l.value[t];e&&(e.quantity=Number(e.quantity||0)+1,e.total=u(e.quantity*(e.unitPrice||e.price||0)),b())}function ue(t){const e=l.value[t];e&&(e.quantity>1?(e.quantity=Number(e.quantity)-1,e.total=u(e.quantity*(e.unitPrice||e.price||0))):l.value.splice(t,1),b())}function ce(t){t>=0&&t<l.value.length&&(l.value.splice(t,1),b())}function Y(t,e){if(t==null||t==="")return 0;const n=String(t).trim();if(n.endsWith("%")){const i=parseFloat(n.slice(0,-1));return isNaN(i)?0:Math.max(0,e*i/100)}const r=parseFloat(n);return isNaN(r)?0:r>0&&r<=100?Math.max(0,e*r/100):Math.max(0,r)}function b(){let t=0,e=0,n=0,r=0,i=0;for(const k of l.value){const E=Number(k.quantity||0),_e=Number(k.unitPrice??k.price??0),ae=u(_e*E);k.total=ae,t+=ae,e+=Number(k.vatSales||0)*E,n+=Number(k.vatAmount||0)*E,r+=Number(k.vatExempt||0)*E,i+=Number(k.zeroRated||0)*E}s.subtotal=u(t);let d=0;o.type==="SC"||o.type==="PWD"?d=u(e*.2):o.type==="MANUAL"?d=u(Y(o.manual,t)):d=u(t*(Number(s.discount||0)/100)),d<0&&(d=0),d>t&&(d=t);const V=u(Math.max(0,t-d)),U=t>0?V/t:1;s.vat_sales=u(e*U),s.vat_amount=u(n*U),s.vat_exempt_sales=u(r*U),s.zero_rated_sales=u(i*U),s.total=V,s._discountAmount=d}$(l,()=>b(),{deep:!0}),$(()=>[o.type,o.manual,s.discount],()=>b());const pe=v(()=>l.value.reduce((t,e)=>t+Number(e.total||0),0)),be=v(()=>{const t=pe.value;return o.type==="SC"||o.type==="PWD"?+(s.vat_sales*.2):o.type==="MANUAL"?Y(o.manual,t):+(t*(Number(s.discount||0)/100))}),ve=v(()=>Math.max(0,Number(w.value)-Number(s.total||0)));v(()=>l.value.map(t=>me(t.quantity,t.productname,t.total)));function me(t,e,n){const r=String(t).padEnd(4," "),i=e.length>18?e.slice(0,18):e.padEnd(18," "),d=Number(n||0).toFixed(2).padStart(10," ");return`${r}${i}${d}`}const ye=v(()=>l.value.length===0),xe=v(()=>!w.value||isNaN(w.value)||Number(w.value)<=0),ge=v(()=>Number(w.value)<Number(s.total)),A=v(()=>!ye.value&&!xe.value&&!ge.value),fe=v(()=>!A.value);function M(){l.value=[],s.discount=0,o.type="",o.manual="",w.value=0,_.name="",_.tin="",b()}async function ee(){if(!l.value.length)return alert("No products added!");if(!A.value)return alert("Tendered amount required");const t={date:x.invoiceDate,total:s.total,discount_amount:be.value,discount_type:o.type||"NONE",vat_sales:s.vat_sales,vat_amount:s.vat_amount,vat_exempt_sales:s.vat_exempt_sales,zero_rated_sales:s.zero_rated_sales,customer_name:_.name||x.issuedBy,items:JSON.stringify(l.value)};try{const e=await window.electron.invoke("add-invoice",t);alert(`Invoice saved! Number: ${e.invoice_number}`),M(),W()}catch(e){console.error("saveInvoice:",e)}}async function te(){try{const t=await window.electron.invoke("check-printer-status");alert(t.connected?"âœ… Printer detected!":"âŒ Printer not detected.")}catch(t){console.error("checkPrinter:",t)}}async function ke(){if(!A.value)return alert("Cannot print: missing or invalid inputs.");if(!z.value)return alert("Receipt template not found!");try{const t=z.value.outerHTML;if(B.value)return;B.value=!0,(await window.electron.invoke("print-receipt",{html:t,openDrawer:!0})).success?(alert("ðŸ–¨ Receipt printed successfully!"),M(),W()):alert("âŒ Print failed!")}catch(t){console.error("printReceipt:",t),alert("Printing error: "+(t&&t.message?t.message:t))}finally{B.value=!1}}function we(t){const e=Number(String(t.target.value).trim());s.discount=isNaN(e)?0:e,b()}Ne(()=>{J();const t=qe(J,1e3);le(),W(),b();const e={save:ee,cancel:M,drawer:K,checkPrinter:te,preview:()=>g.value=!0};window.addEventListener("footer-preview-receipt",async()=>{if(!A.value)return alert("Please enter tendered amount equal to or greater than total before previewing.");await N(300),g.value=!0,await P()}),window.addEventListener("footer-save",async()=>{await N(800),await ee(),await P()}),window.addEventListener("footer-cancel",async()=>{await N(400),M(),await P()}),window.addEventListener("footer-open-drawer",async()=>{await N(500),await K(),await P()}),window.addEventListener("footer-check-printer",async()=>{await N(600),await te(),await P()}),window.addEventListener("footer-preview-receipt",async()=>{await N(300),g.value=!0,await P()}),Pe(()=>{clearInterval(t),I&&clearTimeout(I),window.removeEventListener("footer-save",e.save),window.removeEventListener("footer-cancel",e.cancel),window.removeEventListener("footer-open-drawer",e.drawer),window.removeEventListener("footer-check-printer",e.checkPrinter),window.removeEventListener("footer-preview-receipt",e.preview)})});async function P(){f.value=100,setTimeout(()=>{f.active=!1,f.value=0},150)}Q({progress:f,startProgress:N,finishProgress:P});const he=[{label:"Invoice Number",key:"invoiceNumber"},{label:"Issued By",key:"issuedBy"},{label:"Date",key:"invoiceDate"},{label:"Time",key:"invoiceTime"}];return(t,e)=>{const n=Te("router-link");return p(),c(j,null,[f.active?(p(),c("div",Me,[a("div",{class:"h-full bg-sky-500 dark:bg-sky-400 transition-all",style:Ce({width:f.value+"%"})},null,4)])):q("",!0),a("div",Ue,[a("div",$e,[(p(),c(j,null,H(he,r=>re(Le,{key:r.key,label:r.label,modelValue:x[r.key],"onUpdate:modelValue":i=>x[r.key]=i,readonly:"",class:"dark:bg-slate-800 border-gray-400 dark:text-slate-100"},null,8,["label","modelValue","onUpdate:modelValue"])),64))]),a("div",je,[a("div",Re,[h(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=r=>T.value=r),placeholder:"Search products...",class:"w-full px-3 py-2 rounded-lg border border-gray-400 bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-100 focus:ring-2 focus:ring-sky-400"},null,512),[[C,T.value]]),a("div",ze,[(p(!0),c(j,null,H(ne.value,r=>(p(),c("button",{key:r.id,onClick:i=>ie(r),class:"p-3 rounded-lg shadow transition bg-slate-100 dark:bg-slate-800 hover:bg-sky-200 dark:hover:bg-sky-600 text-center text-sm text-slate-800 dark:text-slate-100 break-words"},m(r.productname),9,Be))),128))])]),a("div",Fe,[a("table",Oe,[e[13]||(e[13]=a("thead",{class:"bg-slate-100 dark:bg-slate-800"},[a("tr",null,[a("th",{class:"px-4 py-2 border-b text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Product"),a("th",{class:"px-4 py-2 border-b text-center text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Qty"),a("th",{class:"px-4 py-2 border-b text-right text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Price"),a("th",{class:"px-4 py-2 border-b text-center text-slate-800 dark:text-slate-100 dark:border-slate-600"},"Action")])],-1)),a("tbody",null,[(p(!0),c(j,null,H(l.value,(r,i)=>(p(),c("tr",{key:r.id,class:"hover:bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-slate-100 transition"},[a("td",We,m(r.productname),1),a("td",He,m(r.quantity),1),a("td",Qe,"â‚±"+m(Number(r.total).toFixed(2)),1),a("td",Ge,[a("div",Je,[a("button",{onClick:d=>ue(i),class:"px-3 py-1 rounded-md font-bold bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-500"},"âˆ’",8,Ze),a("button",{onClick:d=>de(i),class:"px-3 py-1 rounded-md font-bold bg-sky-300 dark:bg-sky-700 hover:bg-sky-400 dark:hover:bg-sky-600"},"+",8,Ke),a("button",{onClick:d=>ce(i),class:"px-3 py-1 rounded-md font-bold bg-red-400 dark:bg-red-700 hover:bg-red-500 dark:hover:bg-red-600"},"Ã—",8,Xe)])])]))),128))])])]),a("div",Ye,[a("div",et,[e[15]||(e[15]=a("h2",{class:"font-semibold text-lg text-slate-800 dark:text-slate-100"},"Customer",-1)),h(a("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>_.name=r),placeholder:"Customer Name (Optional)",class:"w-full text-sm px-3 py-2 rounded border bg-white dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,512),[[C,_.name]]),h(a("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>_.tin=r),placeholder:"TIN (Optional)",class:"w-full text-sm px-3 py-2 rounded border bg-white dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,512),[[C,_.tin]]),re(n,{to:"/customer",class:"inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors duration-200"},{default:Se(()=>[...e[14]||(e[14]=[Ie(" Register Customer ",-1)])]),_:1})]),a("div",tt,[a("div",at,[e[17]||(e[17]=a("h2",{class:"font-semibold text-lg text-slate-800 dark:text-slate-100"},"Discount Type",-1)),h(a("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.type=r),class:"px-2 py-1 rounded border text-sm bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},[...e[16]||(e[16]=[a("option",{value:""},"None",-1),a("option",{value:"SC"},"Senior Citizen (20%)",-1),a("option",{value:"PWD"},"PWD (20%)",-1),a("option",{value:"MANUAL"},"Manual Discount (â‚± or %)",-1)])],512),[[De,o.type]])]),o.type==="SC"||o.type==="PWD"?(p(),c("div",rt,[h(a("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.name=r),placeholder:"Name on ID",class:"w-full text-sm px-3 py-2 rounded border bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,512),[[C,o.name]]),h(a("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.id_no=r),placeholder:"ID Number",class:"w-full text-sm px-3 py-2 rounded border bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,512),[[C,o.id_no]])])):q("",!0),o.type==="MANUAL"?(p(),c("div",st,[e[18]||(e[18]=a("span",{class:"text-slate-700 dark:text-slate-200"},"Discount Amount",-1)),h(a("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.manual=r),placeholder:"0 or 10%",onInput:e[7]||(e[7]=r=>b()),class:"w-28 text-right px-2 py-1 rounded border text-sm bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,544),[[C,o.manual]])])):q("",!0),o.type?q("",!0):(p(),c("div",ot,[e[19]||(e[19]=a("span",{class:"text-slate-700 dark:text-slate-200"},"Discount %",-1)),a("input",{value:s.discount,onInput:e[8]||(e[8]=r=>we(r)),placeholder:"0",class:"w-28 text-right px-2 py-1 rounded border text-sm bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,40,nt)]))]),a("div",lt,[e[24]||(e[24]=a("h2",{class:"font-semibold text-lg text-slate-800 dark:text-slate-100"},"VAT Summary",-1)),a("div",it,[e[20]||(e[20]=a("p",{class:"text-slate-700 dark:text-slate-200"},"VATable Sales",-1)),a("p",null,m(S(s.vat_sales)),1)]),a("div",dt,[e[21]||(e[21]=a("p",{class:"text-slate-700 dark:text-slate-200"},"VAT Amount (12%)",-1)),a("p",null,m(S(s.vat_amount)),1)]),a("div",ut,[e[22]||(e[22]=a("p",{class:"text-slate-700 dark:text-slate-200"},"VAT Exempt",-1)),a("p",null,m(S(s.vat_exempt_sales)),1)]),a("div",ct,[e[23]||(e[23]=a("p",{class:"text-slate-700 dark:text-slate-200"},"Zero-Rated",-1)),a("p",null,m(S(s.zero_rated_sales)),1)])]),a("div",pt,[a("div",bt,[e[25]||(e[25]=a("span",{class:"text-lg text-slate-800 dark:text-slate-100"},"TENDERED",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=r=>w.value=r),onInput:e[10]||(e[10]=r=>b()),class:"w-32 text-right border rounded px-2 py-1 bg-slate-50 dark:bg-slate-800 border-gray-400 text-gray-900 dark:text-gray-100"},null,544),[[C,w.value]])]),a("div",vt,[e[26]||(e[26]=a("span",{class:"text-slate-800 dark:text-slate-100"},"CHANGE",-1)),a("span",mt,m(S(ve.value)),1)])]),a("div",yt,[e[27]||(e[27]=a("span",{class:"text-xl font-semibold text-slate-900 dark:text-slate-100"},"TOTAL",-1)),a("span",xt,m(S(s.total||0)),1)])])]),g.value?(p(),c("div",gt,[a("div",ft,[e[28]||(e[28]=a("h2",{class:"text-lg font-bold mb-3 text-center"},"Receipt Preview",-1)),a("div",{ref_key:"receipt",ref:z},null,512),a("div",kt,[a("button",{onClick:e[11]||(e[11]=r=>g.value=!1),class:"w-1/2 mr-2 py-2 px-4 rounded shadow bg-red-500 hover:bg-red-600 text-slate-100"},"Cancel"),a("button",{disabled:fe.value,onClick:e[12]||(e[12]=r=>{A.value&&(ke(),g.value=!1)}),class:"w-1/2 ml-2 py-2 px-4 rounded shadow bg-green-500 hover:bg-green-600 text-slate-100 disabled:opacity-40"},"Confirm",8,wt)])])])):q("",!0)])],64)}}};export{_t as default};
