import{_ as T,r as o,e as F,k as j,c as y,o as m,b as q,a as t,f as O,F as k,g as A,h as v,v as f,l as V,m as N,n as S,p as P,q as Y,t as U,s as _}from"./DHSkRrcP.js";import{u as H}from"./CnzGTQu5.js";import{c as R}from"./9UVrpZX_.js";const W={__name:"background",setup(z){const g=o(null);let r,n=[];const w=()=>{const i=g.value.getContext("2d"),d=window.innerWidth,c=window.innerHeight;g.value.width=d,g.value.height=c,n=Array.from({length:100},()=>({x:Math.random()*d,y:Math.random()*c,size:Math.random()*2+1,alpha:Math.random(),delta:Math.random()*.02+.005}));const p=()=>{i.clearRect(0,0,d,c);for(let s of n)s.alpha+=s.delta,(s.alpha>=1||s.alpha<=0)&&(s.delta*=-1),i.fillStyle=`rgba(255,255,255,${s.alpha})`,i.fillRect(s.x,s.y,s.size,s.size);r=requestAnimationFrame(p)};p()};return F(()=>{w(),window.addEventListener("resize",w)}),j(()=>{cancelAnimationFrame(r),window.removeEventListener("resize",w)}),(i,d)=>(m(),y("canvas",{ref_key:"canvas",ref:g,class:"fixed top-0 left-0 w-full h-full z-[-1]"},null,512))}},G=T(W,[["__scopeId","data-v-0cbee482"]]);const C=R("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);const L=R("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),J={class:"min-h-screen flex items-center justify-center relative"},K={class:"z-10 p-8 bg-white/10 backdrop-blur-lg rounded-xl shadow-2xl w-[380px]"},Q={key:0,class:"text-white text-center text-lg py-4"},X={class:"relative"},Z=["type"],ee={class:"relative"},te=["type"],ae=["disabled"],le=["disabled"],ne={__name:"index",setup(z){const g=_(),r=o(""),n=o(""),w=o("admin"),i=o(!1),d=o(!1),c=o(""),p=o(""),s=o(""),x=o(""),b=o(!1),h=o(!1),u=o("checking"),M=H("user",()=>null);F(async()=>{try{const a=await window.electronAPI.checkAdmin();u.value=a?"login":"setup"}catch(a){console.error(a),u.value="setup"}});function $(){r.value="",n.value="",c.value=""}function I(a){return/^[0-9]{6}$/.test(a)}async function B(){if(!r.value||!n.value)return alert("Please enter admin name and password.");if(!I(c.value))return alert("PIN must be exactly 6 digits.");try{const a=await window.electronAPI.createAdmin({name:r.value,password:n.value,pin:c.value});a?.success?(alert(`Admin account created!
⚠ IMPORTANT: Remember your master PIN!`),$(),u.value="login"):alert(a?.error||"Failed to create admin.")}catch(a){console.error(a),alert("An error occurred.")}}async function E(){if(!r.value||!n.value)return alert("Please enter your name and password.");h.value=!0;try{const a=await window.electronAPI.login({role:w.value,name:r.value,password:n.value});a?.success?(localStorage.setItem("token","true"),localStorage.setItem("name",a.name),localStorage.setItem("role",a.role),M.value={name:a.name,role:a.role},g.push("/dashboard")):alert(a?.error||"Login failed.")}catch(a){console.error(a),alert("An error occurred.")}finally{h.value=!1}}async function D(){if(!s.value||!x.value||!p.value)return alert("Please fill in all fields.");if(!I(p.value))return alert("Master PIN must be exactly 6 digits.");if(s.value===M.value?.name)return alert("You cannot reset your own password. Ask admin.");b.value=!0;try{const a=await window.electronAPI.resetPassword({name:s.value,newPassword:x.value,pin:p.value});a?.success?(alert("Password updated!"),s.value="",x.value="",p.value="",u.value="login"):alert(a?.error||"Reset failed.")}catch(a){console.error(a),alert("An error occurred.")}finally{b.value=!1}}return(a,e)=>(m(),y("div",J,[q(G),t("div",K,[u.value==="checking"?(m(),y("div",Q,"Loading...")):u.value==="setup"?(m(),y(k,{key:1},[e[14]||(e[14]=t("h2",{class:"text-2xl font-semibold text-center text-white mb-6"}," Setup Admin Account ",-1)),e[15]||(e[15]=t("p",{class:"text-yellow-300 text-sm mb-4 text-center"}," ⚠ Please remember your Master PIN. You cannot recover it. ",-1)),t("form",{onSubmit:A(B,["prevent"]),class:"space-y-4"},[v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),type:"text",placeholder:"Admin Name",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[f,r.value]]),t("div",X,[v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l),type:i.value?"text":"password",placeholder:"Admin Password",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,8,Z),[[V,n.value]]),t("button",{type:"button",onClick:e[2]||(e[2]=l=>i.value=!i.value),class:"absolute right-3 top-1/2 -translate-y-1/2"},[(m(),N(S(i.value?P(C):P(L)),{class:"w-5 h-5 text-black"}))])]),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>c.value=l),type:"password",maxlength:"6",placeholder:"Master PIN (6 digits)",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[f,c.value]]),e[13]||(e[13]=t("button",{class:"w-full bg-green-500 text-white py-2 rounded hover:bg-green-600"}," Create Admin ",-1))],32)],64)):u.value==="login"?(m(),y(k,{key:2},[e[17]||(e[17]=t("h2",{class:"text-2xl font-semibold text-center text-white mb-6"}," Login ",-1)),t("form",{onSubmit:A(E,["prevent"]),class:"space-y-4"},[v(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),class:"w-full p-3 rounded bg-white/80 text-gray-900"},[...e[16]||(e[16]=[t("option",{value:"admin"},"Admin",-1),t("option",{value:"cashier"},"Cashier",-1)])],512),[[Y,w.value]]),v(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>r.value=l),type:"text",placeholder:"Name",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[f,r.value]]),t("div",ee,[v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.value=l),type:d.value?"text":"password",placeholder:"Password",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,8,te),[[V,n.value]]),t("button",{type:"button",onClick:e[7]||(e[7]=l=>d.value=!d.value),class:"absolute right-3 top-1/2 -translate-y-1/2"},[(m(),N(S(d.value?P(C):P(L)),{class:"w-5 h-5 text-black"}))])]),t("button",{disabled:h.value,class:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:bg-gray-400"},U(h.value?"Processing...":"Login"),9,ae),t("p",{class:"text-center text-white underline cursor-pointer",onClick:e[8]||(e[8]=l=>u.value="forgot")}," Forgot Password? ")],32)],64)):u.value==="forgot"?(m(),y(k,{key:3},[e[18]||(e[18]=t("h2",{class:"text-2xl font-semibold text-center text-white mb-6"}," Reset Password ",-1)),t("form",{onSubmit:A(D,["prevent"]),class:"space-y-4"},[v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>s.value=l),type:"text",placeholder:"Existing Username",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[f,s.value]]),v(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>x.value=l),type:"password",placeholder:"New Password",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[f,x.value]]),v(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>p.value=l),type:"password",maxlength:"6",placeholder:"Master PIN",class:"w-full p-3 rounded bg-white/80 text-gray-900"},null,512),[[f,p.value]]),t("button",{disabled:b.value,class:"w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700 disabled:bg-gray-400"},U(b.value?"Updating...":"Reset Password"),9,le),t("p",{class:"text-center text-white underline cursor-pointer",onClick:e[12]||(e[12]=l=>u.value="login")}," Back to Login ")],32)],64)):O("",!0)])]))}};export{ne as default};
