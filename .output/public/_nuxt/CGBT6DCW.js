import{r as m,A as w,C as F,e as I,c as d,a as e,h as f,v as g,F as h,i as T,o as n,f as b,y as N,t as l}from"./URJV-2WR.js";const P={class:"border-slate-200 dark:border-slate-700 text-slate-800 dark:text-slate-100"},$={class:"flex gap-4 items-end mb-4"},z={class:"bg-slate-50 dark:bg-slate-600 p-4 rounded shadow mb-6"},S={class:"min-w-full border border-slate-300 dark:border-slate-700 border-collapse"},B=["onClick"],E=["rowspan"],U=["rowspan"],j=["rowspan"],L={class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},R={class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},q={class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},H={class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},M=["rowspan"],Q=["rowspan"],W=["rowspan"],O=["rowspan"],Z={key:0,class:"bg-slate-100 dark:bg-slate-700"},G={colspan:"11",class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},J={class:"grid grid-cols-2 gap-4 text-sm"},Y={__name:"transactions",setup(K){const x=m([]),p=m(""),c=m(""),y=m(null),k=m(!1);function o(r){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(r||0)}const _=w(()=>x.value.filter(r=>{const a=new Date(r.date);return!(p.value&&a<new Date(p.value)||c.value&&a>new Date(c.value))}));F(_,r=>{y.value=r.length?r[0].id:null});function A(r){k.value||(y.value=y.value===r?null:r)}w(()=>_.value.reduce((r,a)=>(r.vat_sales+=a.vat_sales||0,r.vat_amount+=a.vat_amount||0,r.vat_exempt_sales+=a.vat_exempt_sales||0,r.zero_rated_sales+=a.zero_rated_sales||0,r.discount+=a.discount||0,r.total+=a.total||0,r),{vat_sales:0,vat_amount:0,vat_exempt_sales:0,zero_rated_sales:0,discount:0,total:0}));function V(){p.value="",c.value=""}function C(){k.value=!0;const r=["Invoice #","Date","Customer","Product","Quantity","VAT-Amount","Total With VAT","VAT Sales","VAT Amount","Discount","Total","Issued By"],a=[];_.value.forEach(s=>{const i=s.patient_id?`${s.lastName}, ${s.firstName}`:s.customer_name;s.items.forEach(v=>{a.push([s.invoice_number,s.date,i,v.productname,v.quantity,v.vat_amount,o(v.total),o(s.vat_sales),o(s.vat_amount),o(s.discount),o(s.total),s.issued_by])})});const t=new Blob([[r,...a].map(s=>s.join(",")).join(`
`)]),u=document.createElement("a");u.href=URL.createObjectURL(t),u.download=`invoices_${Date.now()}.csv`,u.click()}async function D(){k.value=!0;const r=_.value.map(a=>({...a,items:a.items,vat_breakdown:{vat_sales:a.vat_sales,vat_amount:a.vat_amount,vat_exempt_sales:a.vat_exempt_sales,zero_rated_sales:a.zero_rated_sales}}));await window.electron.invoke("export-invoices-pdf",r)}return I(async()=>{x.value=await window.electron.invoke("get-all-invoices")}),(r,a)=>(n(),d("div",P,[e("div",$,[e("div",null,[a[2]||(a[2]=e("label",{class:"block text-sm font-medium"},"From",-1)),f(e("input",{type:"date","onUpdate:modelValue":a[0]||(a[0]=t=>p.value=t),class:"mt-1 border rounded px-2 py-1 bg-slate-50 dark:bg-slate-800"},null,512),[[g,p.value]])]),e("div",null,[a[3]||(a[3]=e("label",{class:"block text-sm font-medium"},"To",-1)),f(e("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=t=>c.value=t),class:"mt-1 border rounded px-2 py-1 bg-slate-50 dark:bg-slate-800"},null,512),[[g,c.value]])]),e("button",{onClick:V,class:"px-4 py-2 bg-gray-400 rounded"},"Clear"),e("button",{onClick:C,class:"px-4 py-2 bg-sky-400 text-white rounded"},"Save as CSV"),e("button",{onClick:D,class:"px-4 py-2 bg-orange-400 text-white rounded"},"Save as PDF")]),e("div",z,[e("table",S,[a[4]||(a[4]=e("thead",{class:"bg-slate-400"},[e("tr",null,[e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Invoice #"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Date"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Customer"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Product"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Quantity"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"VAT from Product"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Total With VAT"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"VAT Sales"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Discount"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Total"),e("th",{class:"px-4 py-2 border border-slate-300 dark:border-slate-700"},"Issued By")])],-1)),e("tbody",null,[(n(!0),d(h,null,T(_.value,t=>(n(),d(h,{key:t.id},[(n(!0),d(h,null,T(t.items,(u,s)=>(n(),d("tr",{key:`${t.id}-${s}`,onClick:i=>s===0&&A(t.id),class:N(["cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-700",k.value&&"opacity-60 cursor-not-allowed"])},[s===0?(n(),d("td",{key:0,rowspan:t.items.length,class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},l(t.invoice_number),9,E)):b("",!0),s===0?(n(),d("td",{key:1,rowspan:t.items.length,class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},l(t.date),9,U)):b("",!0),s===0?(n(),d("td",{key:2,rowspan:t.items.length,class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},l(t.patient_id?`${t.lastName}, ${t.firstName}`:t.customer_name),9,j)):b("",!0),e("td",L,l(u.productname),1),e("td",R,l(u.quantity),1),e("td",q,l(u.vat_amount),1),e("td",H,l(o(u.total)),1),s===0?(n(),d("td",{key:3,rowspan:t.items.length,class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},l(o(t.vat_sales)),9,M)):b("",!0),s===0?(n(),d("td",{key:4,rowspan:t.items.length,class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},l(o(t.discount)),9,Q)):b("",!0),s===0?(n(),d("td",{key:5,rowspan:t.items.length,class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},l(o(t.total)),9,W)):b("",!0),s===0?(n(),d("td",{key:6,rowspan:t.items.length,class:"border border-slate-300 dark:border-slate-700 px-2 py-1"},l(t.issued_by),9,O)):b("",!0)],10,B))),128)),y.value===t.id?(n(),d("tr",Z,[e("td",G,[e("div",J,[e("div",null,"VAT Sales: "+l(o(t.vat_sales)),1),e("div",null,"VAT Amount: "+l(o(t.vat_amount)),1),e("div",null,"VAT-Exempt: "+l(o(t.vat_exempt_sales)),1),e("div",null,"Zero-Rated: "+l(o(t.zero_rated_sales)),1)])])])):b("",!0)],64))),128))])])])]))}};export{Y as default};
