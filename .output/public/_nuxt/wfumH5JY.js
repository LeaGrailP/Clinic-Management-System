import{_ as st,r,s as lt,e as I,m as y,q as M,c as i,a as e,h as j,v as A,f as L,F as _,i as h,b as B,w as X,t as o,j as ot,d as k,x as nt,o as d}from"./_qwiZnX4.js";const at=window.setInterval,rt={class:"bg-slate-50 min-h-screen p-6 space-y-6"},it={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},dt=["value"],ut=["value"],ct={class:"relative"},vt={key:0,class:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-40 overflow-y-auto"},ft=["onClick"],pt={class:"bg-white rounded-lg shadow p-6 border border-gray-200"},bt={class:"flex flex-col lg:flex-row gap-6"},yt={class:"flex-1 overflow-auto"},mt={class:"min-w-full border border-gray-300 text-sm text-left"},gt=["onClick"],xt={class:"p-2 border"},wt={class:"flex-1 overflow-auto"},_t={class:"min-w-full border border-gray-300 text-sm text-left"},ht={class:"p-2 border"},kt={class:"p-2 border"},Tt={class:"p-2 border"},Nt={class:"p-2 border space-x-2 flex justify-center items-center"},Ct=["onClick"],It=["onClick"],jt={class:"w-full lg:w-1/3 space-y-4"},At={class:"bg-white p-4 rounded-lg shadow border border-gray-200 space-y-2"},Pt={class:"flex justify-between"},St={class:"text-xl"},Et={class:"flex justify-between"},Dt={class:"text-xl"},Vt={class:"flex justify-between"},Ot={class:"text-xl"},Rt={class:"flex justify-between"},qt={class:"text-xl"},Ut={class:"bg-white p-4 rounded-lg shadow border border-gray-200 space-y-2"},Ft={class:"flex justify-between items-center space-x-2"},Mt={class:"relative w-28"},Lt=["value"],Bt={class:"flex justify-between items-center space-x-2"},Xt={class:"relative w-28"},$t=["value"],zt={class:"flex justify-between items-center space-x-2"},Ht={class:"bg-white p-4 rounded-lg shadow border border-gray-200 space-y-2 flex justify-between"},Qt={class:"text-center mb-2"},Yt={class:"grid-cols-4 flex flex-row justify-between w-full"},Gt={class:"truncate max-w-[140px] basis-2/5"},Jt={class:"basis-1/5"},Wt={class:"basis-1/5"},Zt={class:"basis-1/5"},Kt={key:0,class:"text-xs text-gray-700"},te={class:"flex justify-between"},ee={class:"flex justify-between"},se={class:"flex justify-between"},le={class:"flex justify-between font-bold text-lg"},oe={class:"flex justify-between"},ne={class:"flex justify-between"},ae={class:"mt-6 p-4 bg-gray-50 rounded-lg shadow"},re={key:0},ie={class:"flex justify-between"},de={class:"flex justify-between"},ue={class:"flex justify-between"},ce={class:"flex justify-between"},ve={key:1,class:"text-gray-500 italic"},fe={__name:"dashboard",setup(pe){const $=r(localStorage.getItem("name")||"Unknown User"),f=r(""),m=r(""),T=r(""),P=r([]),u=r([]),n=lt({vat_sales:0,vat_amount:0,vat_exempt_sales:0,zero_rated_sales:0,discount:0,total:0}),p=r(0),S=r(null);function a(s){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s||0)}function E(){const s=new Date;f.value=s.toISOString().split("T")[0],m.value=s.toTimeString().slice(0,5)}const D=r([]),b=r(""),c=r(null),g=r(!1),N=r(null);async function V(){try{D.value=await window.electron.invoke("get-patients")}catch(s){console.error("Error fetching patients:",s)}}I(V);const O=y(()=>D.value.filter(s=>(s.firstName+" "+s.lastName).toLowerCase().includes(b.value.toLowerCase())));function z(s){c.value=s,b.value=s.firstName+" "+s.lastName,g.value=!1}function R(s){N.value&&!N.value.contains(s.target)&&(g.value=!1)}I(()=>{document.addEventListener("click",R)}),M(()=>{document.removeEventListener("click",R)});async function H(){try{P.value=await window.electron.invoke("get-products")}catch(s){console.error("Error fetching products:",s)}}async function q(){try{T.value=await window.electron.invoke("generate-invoice-number")}catch(s){console.error("Failed to fetch invoice number:",s)}}function Q(s){const t=u.value.find(x=>x.id===s.id);t?(t.quantity+=1,t.total=t.quantity*(t.price+t.vatAmount)):u.value.push({...s,quantity:1,total:s.price+s.vatAmount}),v()}function Y(s){const t=u.value[s];t.quantity+=1,t.total=t.quantity*(t.price+t.vatAmount),v()}function G(s){const t=u.value[s];t.quantity-=1,t.quantity<=0?u.value.splice(s,1):t.total=t.quantity*(t.price+t.vatAmount),v()}function v(){let s=0;n.vat_sales=0,n.vat_amount=0,n.vat_exempt_sales=0,n.zero_rated_sales=0,u.value.forEach(t=>{n.vat_sales+=t.vat||0,n.vat_amount+=t.vatAmount||0,s+=t.total||0}),n.total=Math.max(s-s*(n.discount/100),0)}function J(s){let t=parseFloat(s.target.value);(isNaN(t)||t<0)&&(t=0),t>100&&(t=100),n.discount=t,v()}const C=y(()=>u.value.reduce((s,t)=>s+t.total,0)),W=y(()=>C.value*.12),Z=y(()=>C.value*(n.discount/100)),U=y(()=>Math.max(p.value-n.total,0));function F(){u.value=[],n.discount=0,p.value=0,v()}async function K(){if(!u.value.length)return alert("No products added!");const s={date:f.value,total:n.total,items:JSON.stringify(u.value)};try{const t=await window.electron.invoke("add-invoice",s);alert(`Invoice saved! Number: ${t.invoice_number}`),tt(),F(),q()}catch(t){console.error("Failed to save invoice:",t)}}function tt(){const s=window.open("","","width=300,height=600");s.document.write("<html><head><title>Receipt</title><style>"),s.document.write(`
    body { font-family: monospace; font-size: 12px; }
    .flex { display: flex; justify-content: space-between; }
    .truncate { overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
    hr { border: none; border-top: 1px dashed black; margin: 2px 0; }
  `),s.document.write("</style></head><body>"),s.document.write(S.value.innerHTML),s.document.write("</body></html>"),s.document.close(),s.print()}return I(()=>{E();const s=at(E,1e3);M(()=>clearInterval(s)),V(),H(),q()}),(s,t)=>{const x=nt("router-link");return d(),i("div",rt,[e("div",it,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Invoice #",-1)),e("input",{type:"text",class:"mt-1 w-full rounded-lg border-gray-300 shadow-sm focus:ring-sky-500 focus:border-sky-500",value:T.value,readonly:""},null,8,dt)]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Issued By",-1)),e("input",{type:"text",value:$.value,class:"mt-1 w-full rounded-lg border-gray-300 shadow-sm focus:ring-sky-500 focus:border-sky-500",readonly:""},null,8,ut)]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700"},"Invoice Date",-1)),j(e("input",{type:"date",class:"mt-1 w-full rounded-lg border-gray-300 shadow-sm focus:ring-sky-500 focus:border-sky-500","onUpdate:modelValue":t[0]||(t[0]=l=>f.value=l),readonly:""},null,512),[[A,f.value]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700"},"Invoice Time",-1)),j(e("input",{type:"time",class:"mt-1 w-full rounded-lg border-gray-300 shadow-sm focus:ring-sky-500 focus:border-sky-500","onUpdate:modelValue":t[1]||(t[1]=l=>m.value=l),readonly:""},null,512),[[A,m.value]])]),e("div",{class:"relative",ref_key:"dropdownRef",ref:N},[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Customer",-1)),e("div",ct,[j(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=l=>b.value=l),placeholder:"Search customer...",onInput:t[3]||(t[3]=l=>g.value=!0),class:"w-full rounded-lg border-gray-300 shadow-sm focus:ring-sky-500 focus:border-sky-500 pl-3 pr-8 py-2"},null,544),[[A,b.value]]),g.value&&O.value.length>0&&b.value?(d(),i("ul",vt,[(d(!0),i(_,null,h(O.value,l=>(d(),i("li",{key:l.id,onClick:w=>z(l),class:"px-4 py-2 cursor-pointer hover:bg-sky-100"},o(l.firstName)+" "+o(l.lastName),9,ft))),128))])):L("",!0)])],512),e("div",null,[B(x,{to:"/customer",class:"mt-4 inline-block px-4 py-2 bg-sky-500 text-white rounded-lg shadow hover:bg-sky-600"},{default:X(()=>t[11]||(t[11]=[k(" + Add New Customer ",-1)])),_:1,__:[11]})])]),e("div",pt,[e("div",bt,[e("div",yt,[e("table",mt,[t[12]||(t[12]=e("thead",{class:"bg-sky-300 text-gray-800"},[e("tr",null,[e("th",{class:"px-4 py-2 border"},"Product List")])],-1)),e("tbody",null,[(d(!0),i(_,null,h(P.value,l=>(d(),i("tr",{key:l.id,class:"text-center hover:bg-gray-50 cursor-pointer",onClick:w=>Q(l)},[e("td",xt,o(l.productname),1)],8,gt))),128))])])]),e("div",wt,[e("table",_t,[t[13]||(t[13]=e("thead",{class:"bg-sky-300 text-gray-800"},[e("tr",null,[e("th",{class:"px-4 py-2 border"},"Product"),e("th",{class:"px-4 py-2 border"},"Quantity"),e("th",{class:"px-4 py-2 border"},"Price"),e("th",{class:"px-4 py-2 border"},"Action")])],-1)),e("tbody",null,[(d(!0),i(_,null,h(u.value,(l,w)=>(d(),i("tr",{key:l.id,class:"text-center hover:bg-gray-50"},[e("td",ht,o(l.productname),1),e("td",kt,o(l.quantity),1),e("td",Tt,"₱"+o(l.total.toFixed(2)),1),e("td",Nt,[e("button",{onClick:et=>G(w),class:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300"},"−",8,Ct),e("button",{onClick:et=>Y(w),class:"px-2 py-1 bg-gray-200 rounded hover:bg-gray-300"},"+",8,It)])]))),128))])])]),e("div",jt,[e("div",At,[e("div",Pt,[t[14]||(t[14]=e("p",{class:"font-bold text-lg"},"Total VAT Sales",-1)),e("p",St,o(a(n.vat_sales)),1)]),e("div",Et,[t[15]||(t[15]=e("p",{class:"font-bold text-lg"},"Total VAT Amount",-1)),e("p",Dt,o(a(n.vat_amount)),1)]),e("div",Vt,[t[16]||(t[16]=e("p",{class:"font-bold text-lg"},"Total VAT-Exempt Sales",-1)),e("p",Ot,o(a(n.vat_exempt_sales)),1)]),e("div",Rt,[t[17]||(t[17]=e("p",{class:"font-bold text-lg"},"Total Zero-Rated Sales",-1)),e("p",qt,o(a(n.zero_rated_sales)),1)])]),e("div",Ut,[e("div",Ft,[t[19]||(t[19]=e("span",{class:"font-bold"},"DISCOUNT",-1)),e("div",Mt,[e("input",{type:"text",value:n.discount,onInput:t[4]||(t[4]=l=>J(l)),placeholder:"0",class:"w-full text-right border rounded px-6 py-1 focus:outline-sky-500"},null,40,Lt),t[18]||(t[18]=e("span",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500"},"%",-1))])]),e("div",Bt,[t[21]||(t[21]=e("span",{class:"font-bold"},"TENDERED",-1)),e("div",Xt,[t[20]||(t[20]=e("span",{class:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-500"},"₱",-1)),e("input",{type:"text",value:p.value,onInput:t[5]||(t[5]=l=>{p.value=parseFloat(l.target.value)||0,v()}),placeholder:"0.00",class:"w-full text-right border rounded px-6 py-1 focus:outline-sky-500"},null,40,$t)])]),e("div",zt,[t[22]||(t[22]=e("span",{class:"font-bold"},"CHANGE",-1)),e("span",null,o(a(U.value)),1)])]),e("div",Ht,[t[23]||(t[23]=e("span",null,"TOTAL",-1)),e("span",null,o(a(n.total||0)),1)]),e("div",null,[B(x,{to:"/transactions",class:"text-blue-500 hover:underline"},{default:X(()=>t[24]||(t[24]=[k(" View All Invoices → ",-1)])),_:1,__:[24]})])])])]),e("div",{class:"grid grid-cols-1 md:grid-cols-4 gap-4"},[e("button",{onClick:K,class:"w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg shadow"},"Save and Print Reciept"),e("button",{onClick:F,class:"w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg shadow"},"Cancel Transaction"),t[25]||(t[25]=e("button",{class:"w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg shadow"},"Open Drawer",-1))]),e("div",{ref_key:"receipt",ref:S,class:"receipt-container p-4 font-mono hidden"},[e("div",Qt,[t[26]||(t[26]=e("div",{class:"text-lg font-bold"},"FETHEA POS",-1)),t[27]||(t[27]=e("div",null,"Pico, La Trinidad",-1)),t[28]||(t[28]=e("div",null,"Tel: 0917-XXX-XXXX",-1)),e("div",null,"Date: "+o(f.value)+" "+o(m.value),1),e("div",null,"Invoice #: "+o(T.value),1)]),t[41]||(t[41]=ot('<hr class="border-t border-black my-1" data-v-4f515e81><div class="grid-cols-4 flex flex-row justify-between w-full" data-v-4f515e81><div class="basis-2/5" data-v-4f515e81>PRODUCT NAME</div><div class="basis-1/5" data-v-4f515e81>QTY</div><div class="basis-1/5" data-v-4f515e81>PPRICE</div><div class="basis-1/5" data-v-4f515e81>AMOUNT</div></div><hr class="border-t border-black my-1" data-v-4f515e81>',3)),(d(!0),i(_,null,h(u.value,l=>(d(),i("div",{key:l.id,class:"mb-1"},[e("div",Yt,[e("div",Gt,o(l.productname),1),e("div",Jt,o(l.quantity),1),e("div",Wt,o(a(l.price)),1),e("div",Zt,o(a(l.total)),1)]),l.productname.length>20?(d(),i("div",Kt,o(l.productname),1)):L("",!0)]))),128)),t[42]||(t[42]=e("hr",{class:"border-t border-black my-1"},null,-1)),e("div",te,[t[29]||(t[29]=e("span",null,"Subtotal:",-1)),e("span",null,o(a(C.value)),1)]),e("div",ee,[t[30]||(t[30]=e("span",null,"VAT (12%):",-1)),e("span",null,o(a(W.value)),1)]),e("div",se,[t[31]||(t[31]=e("span",null,"Discount:",-1)),e("span",null,o(a(Z.value)),1)]),e("div",le,[t[32]||(t[32]=e("span",null,"Total:",-1)),e("span",null,o(a(n.total)),1)]),t[43]||(t[43]=e("hr",{class:"border-t border-black my-1"},null,-1)),t[44]||(t[44]=e("div",{class:"flex justify-between"},[e("span",null,"Payment:"),e("span",null,"Cash")],-1)),e("div",oe,[t[33]||(t[33]=e("span",null,"Tendered:",-1)),e("span",null,o(a(p.value)),1)]),e("div",ne,[t[34]||(t[34]=e("span",null,"Change:",-1)),e("span",null,o(a(U.value)),1)]),t[45]||(t[45]=e("hr",{class:"border-t border-black my-1"},null,-1)),e("div",ae,[t[40]||(t[40]=e("div",{class:"text-lg font-bold mb-2"},"CUSTOMER INFORMATION",-1)),c.value?(d(),i("div",re,[e("div",ie,[t[35]||(t[35]=e("span",{class:"font-medium"},"NAME:",-1)),e("span",null,o(c.value.lastName)+" "+o(c.value.firstName)+" "+o(c.value.middleName),1)]),e("div",de,[t[36]||(t[36]=e("span",{class:"font-medium"},"ADDRESS:",-1)),e("span",null,o(c.value.address),1)]),e("div",ue,[t[37]||(t[37]=e("span",{class:"font-medium"},"TIN:",-1)),e("span",null,o(c.value.tin),1)]),e("div",ce,[t[38]||(t[38]=e("span",{class:"font-medium"},"BUS. TYPE:",-1)),e("span",null,o(c.value.businessStyle),1)]),t[39]||(t[39]=e("hr",{class:"border-t border-black my-1"},null,-1))])):(d(),i("div",ve," No customer selected "))]),t[46]||(t[46]=e("div",{class:"text-center text-sm mt-2"},[k(" Thank you for shopping!"),e("br"),k(" No returns without receipt. ")],-1))],512)])}}},ye=st(fe,[["__scopeId","data-v-4f515e81"]]);export{ye as default};
